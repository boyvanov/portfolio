(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{393:function(e,t,r){},409:function(e,t,r){"use strict";var i=r(393);r.n(i).a},425:function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"reviews__new",class:{blocked:e.formIsBlocked}},[e._m(0),r("div",{staticClass:"reviews__new-content"},[r("form",{staticClass:"reviews__new-form"},[r("div",{staticClass:"reviews__new-avatar-wrap"},[r("label",{staticClass:"reviews__new-avatar",class:{error:e.validation.hasError("renderedPhotoUrl")}},[r("input",{staticClass:"reviews__new-file-input",attrs:{type:"file"},on:{change:e.appendFileAndRenderPhoto}}),r("errorTooltip",{attrs:{errorText:e.validation.firstError("renderedPhotoUrl")}}),r("div",{staticClass:"reviews__new-pic"},[r("div",{staticClass:"reviews__new-avatar-empty",class:{filled:this.renderedPhotoUrl.length},style:{backgroundImage:"url("+this.renderedPhotoUrl+")"}})]),r("div",{staticClass:"reviews__new-addphoto"},[e._v("Добавить фото")])],1)]),r("div",{staticClass:"reviews__new-desc"},[r("div",{staticClass:"reviews__new-row"},[r("label",{staticClass:"reviews__new-block",class:{error:e.validation.hasError("reviewNew.author")}},[r("div",{staticClass:"reviews__new-block-title"},[e._v("Имя автора")]),r("input",{directives:[{name:"model",rawName:"v-model",value:e.reviewNew.author,expression:"reviewNew.author"}],staticClass:"reviews__new-field",attrs:{type:"text",name:"name",placeholder:"Имя автора"},domProps:{value:e.reviewNew.author},on:{input:function(t){t.target.composing||e.$set(e.reviewNew,"author",t.target.value)}}}),r("errorTooltip",{attrs:{errorText:e.validation.firstError("reviewNew.author")}})],1),r("label",{staticClass:"reviews__new-block",class:{error:e.validation.hasError("reviewNew.occ")}},[r("div",{staticClass:"reviews__new-block-title"},[e._v("Титул автора")]),r("input",{directives:[{name:"model",rawName:"v-model",value:e.reviewNew.occ,expression:"reviewNew.occ"}],staticClass:"reviews__new-field",attrs:{type:"text",name:"position",placeholder:"Титул автора"},domProps:{value:e.reviewNew.occ},on:{input:function(t){t.target.composing||e.$set(e.reviewNew,"occ",t.target.value)}}}),r("errorTooltip",{attrs:{errorText:e.validation.firstError("reviewNew.occ")}})],1)]),r("div",{staticClass:"reviews__new-row"},[r("label",{staticClass:"reviews__new-block",class:{error:e.validation.hasError("reviewNew.text")}},[r("div",{staticClass:"reviews__new-block-title"},[e._v("Отзыв")]),r("textarea",{directives:[{name:"model",rawName:"v-model",value:e.reviewNew.text,expression:"reviewNew.text"}],staticClass:"reviews__new-textarea",attrs:{type:"text",name:"review",placeholder:"Отзыв"},domProps:{value:e.reviewNew.text},on:{input:function(t){t.target.composing||e.$set(e.reviewNew,"text",t.target.value)}}}),r("errorTooltip",{attrs:{errorText:e.validation.firstError("reviewNew.text")}})],1)]),r("div",{staticClass:"reviews__buttons"},[r("button",{staticClass:"btn-cancel",attrs:{type:"button"},on:{click:e.CLOSE_FORM}},[e._v("Отмена    ")]),e.reviewForm.editMode?e._e():r("button",{staticClass:"btn",attrs:{type:"button"},on:{click:e.addNewReview}},[e._v("Сохранить")]),e.reviewForm.editMode?r("button",{staticClass:"btn",attrs:{type:"button"},on:{click:e.saveEditedReview}},[e._v("Сохранить")]):e._e()])])])])])};i._withStripped=!0;var a=r(96),n=r(348);function o(e,t,r,i,a,n,o){try{var s=e[n](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(i,a)}function s(e){return function(){var t=this,r=arguments;return new Promise(function(i,a){var n=e.apply(t,r);function s(e){o(n,i,a,s,c,"next",e)}function c(e){o(n,i,a,s,c,"throw",e)}s(void 0)})}}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},i=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),i.forEach(function(t){v(e,t,r[t])})}return e}function v(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var w={mixins:[r(348).mixin],validators:{"reviewNew.author":function(e){return n.Validator.value(e).required("Введите имя")},"reviewNew.occ":function(e){return n.Validator.value(e).required("Введите позицию")},renderedPhotoUrl:function(e){return n.Validator.value(e).required("Загрузите изображение")},"reviewNew.text":function(e){return n.Validator.value(e).required("Введите отзыв")}},data:function(){return{renderedPhotoUrl:"",reviewNew:{author:"",occ:"",photo:"",text:""},formIsBlocked:!1}},components:{errorTooltip:function(){return r.e(0).then(r.bind(null,422))}},computed:c({},Object(a.e)("reviews",{reviewForm:function(e){return e.reviewForm},editedReview:function(e){return e.editedReview}}),{remotePhotoPath:function(){return"https://webdev-api.loftschool.com/".concat(this.reviewNew.photo)}}),methods:c({},Object(a.b)("reviews",["addReview","editReview"]),Object(a.d)("reviews",["CLOSE_FORM"]),Object(a.d)("tooltip",["SHOW_TOOLTIP"]),{appendFileAndRenderPhoto:function(e){var t=this,r=e.target.files[0];this.reviewNew.photo=r;var i=new FileReader;try{i.readAsDataURL(r),i.onload=function(){t.renderedPhotoUrl=i.result}}catch(e){alert(e.message)}},createReviewFormData:function(){var e=new FormData;return e.append("author",this.reviewNew.author),e.append("photo",this.reviewNew.photo),e.append("text",this.reviewNew.text),e.append("occ",this.reviewNew.occ),e},addNewReview:function(){var e=s(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$validate();case 2:if(e.t0=e.sent,!1!==e.t0){e.next=5;break}return e.abrupt("return");case 5:return this.formIsBlocked=!0,e.prev=6,t=this.createReviewFormData(),e.next=10,this.addReview(t);case 10:this.SHOW_TOOLTIP({type:"success",text:"Отзыв добавлен"}),this.reviewNew.author="",this.reviewNew.occ="",this.reviewNew.text="",this.renderedPhotoUrl="",this.validation.reset(),e.next=21;break;case 18:e.prev=18,e.t1=e.catch(6),this.SHOW_TOOLTIP({type:"error",text:"Произошла ошибка"});case 21:return e.prev=21,this.formIsBlocked=!1,e.finish(21);case 24:case"end":return e.stop()}},e,this,[[6,18,21,24]])}));return function(){return e.apply(this,arguments)}}(),setEditedReview:function(){this.reviewNew=c({},this.editedReview),this.renderedPhotoUrl=this.remotePhotoPath},saveEditedReview:function(){var e=s(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$validate();case 2:if(e.t0=e.sent,!1!==e.t0){e.next=5;break}return e.abrupt("return");case 5:return e.prev=5,e.next=8,this.editReview(this.reviewNew);case 8:this.SHOW_TOOLTIP({type:"success",text:"Отзыв изменен"}),this.CLOSE_FORM(),e.next=15;break;case 12:e.prev=12,e.t1=e.catch(5),this.SHOW_TOOLTIP({type:"error",text:"Произошла ошибка"});case 15:case"end":return e.stop()}},e,this,[[5,12]])}));return function(){return e.apply(this,arguments)}}()}),created:function(){this.reviewForm.editMode&&this.setEditedReview()}},l=(r(409),r(95)),u=Object(l.a)(w,i,[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"reviews__new-title"},[t("div",{staticClass:"reviews__new-name"},[this._v("Новый отзыв")])])}],!1,null,null,null);u.options.__file="src/admin/components/reviewsForm.vue";t.default=u.exports}}]);